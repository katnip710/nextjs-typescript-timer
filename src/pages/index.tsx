import type { NextPage } from "next";
import Head from "next/head";
import Moon from "../components/MoonBackground";
import SpookyMusic from "../components/SpookyMusic";
import { useEffect, useState } from "react";

function Home() {

  const [start, setStart] = useState(false)
  const openTimer = () => setStart(true);

  const [spookyTime, setSpookyTime] = useState(false)

  const [days, setDays] = useState(0)
  const [hours, setHours] = useState(0)
  const [minutes, setMinutes] = useState(0)
  const [seconds, setSeconds] = useState(0)

  useEffect(() =>{
      const target = new Date('10/30/2022 23:59:59')
      //const target = new Date ('08/12/2022 1:51:00')

      const interval = setInterval(() => {
      const now = new Date()
      const difference = target.getTime() - now.getTime()

      const d = Math.floor(difference / (1000 * 60 * 60 *24))
      setDays(d)

      const h = Math.floor(
          (difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
      )
      setHours(h)

      const m = Math.floor(
          (difference % (1000 * 60 * 60)) / (1000 * 60)
      )
      setMinutes(m)

      const s = Math.floor(
          (difference % (1000 * 60)) / 1000
      )
      setSeconds(s)

      if(d <= 0 && h <= 0 && m <= 0 && s <= m){
          setSpookyTime(true)
      }

      }, 1000)

      return () => clearInterval(interval)
  }, [])

  return (
    <>
      <Head>
        <title>CountDown Timer</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="img/FullMoon.png" />
      </Head>

      <div className="start-timer-button" style={{
        display: start ? 'none' : 'flex',
      }}>
        <h1 onClick={openTimer}>Start Countdown to Halloween</h1>
      </div>

      <Moon />

      <main style={{
        display: start ? 'flex' : 'none',
      }}>
        {spookyTime ? (
            <div className="halloweenTime">
                <iframe width="560" height="349" src="https://www.youtube.com/embed/8wUixhV13gI?autoplay=1&mute=1&showinfo=0&controls=1" title="YouTube video player" frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowFullScreen></iframe>

                <h1>Happy Halloween!</h1>
            </div>
            ) : (

            <div className="timer-wrapper">
                <h2>Countdown to Halloween</h2>

                <div className="timer-inner">
                    <div className="timer-segment">
                        <span className="time">{days}</span>
                        <span className="label">Days</span>
                    </div>
                    <div className="timer-segment">
                        <span className="time">{hours}</span>
                        <span className="label">Hours</span>
                    </div>
                    <div className="timer-segment">
                        <span className="time">{minutes}</span>
                        <span className="label">Minutes</span>
                    </div>
                    <div className="timer-segment">
                        <span className="time">{seconds}</span>
                        <span className="label">Seconds</span>
                    </div>
                </div>

                <SpookyMusic />
            </div>
        )}
        </main>
    </>
  );
};

export default Home;

